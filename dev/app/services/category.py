# app/services/parser/category.py
from __future__ import annotations
from typing import Optional

CATEGORY_KEYWORDS: dict[str, list[str]] = {
    "Еда": ["еда","продукты","обед","ужин","завтрак","кофе","чай","бургер","шаурма","пицц","суп","хлеб","сыр","вода","кола","напиток","кафе","ресторан","магазин"],
    "Транспорт": ["такси","метро","автобус","троллейбус","маршрутка","поезд","каршер","топливо","бензин","дизель","парковка"],
    "Сигареты": ["сигарет","сиги","табак","вейп","iqos","снюс"],
    "Связь и интернет": ["связь","интернет","мобил","оператор","тариф","минуты","гигаб"],
    "Подписки": ["подписка","spotify","netflix","youtube","yandex","яндекс","okko","ivi","chatgpt","apple","google one"],
    "Коммунальные платежи": ["коммунал","жкх","свет","электр","вода","газ","квартир","аренд","интернет дом"],
    "Развлечения": ["кино","кинотеатр","игры","steam","playstation","xbox","развлеч","бар","ночной","кальян"],
    "Здоровье": ["аптек","лекар","врач","стомат","массаж","анализ"],
    "Одежда": ["одежд","кроссовк","кед","куртк","джинс","футболк","носки"],
    "Доход": ["зарплат","премия","revshare","рефшар","фриланс","перевод","возврат","кэшбек","cashback","комиссия"],
}

def detect_category(text: str, op_type: str) -> Optional[str]:
    t = text.lower()
    # Доходы в отдельную категорию, если ключи найдены
    if op_type == "income":
        for cat in ("Доход",):
            if any(k in t for k in CATEGORY_KEYWORDS.get(cat, [])):
                return cat
        return "Доход"
    # Расходы: по ключам
    for cat, keys in CATEGORY_KEYWORDS.items():
        if any(k in t for k in keys):
            if cat == "Доход":
                continue
            return cat
    return "Прочее"
